
{% extends 'navbar.html' %}
{% load static %}
{% block content %}
<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Colorlib Templates">
    <meta name="author" content="Colorlib">
    <meta name="keywords" content="Colorlib Templates">

    <!-- Title Page-->


    <!-- Icons font CSS-->
<!--    <link href="{% static 'mdi-font/css/material-design-iconic-font.min.css' %}" rel="stylesheet" media="all">-->
<link href="{% static 'css/material-design-iconic-font.min.css' %}" rel="stylesheet" media="all">

    <!-- <link href="{% static 'font-awesome-4.7/css/font-awesome.min.css' %}" rel="stylesheet" media="all"> -->
    <!-- Font special for pages-->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Vendor CSS-->
    <link href="{% static 'css/select2.min.css' %}" rel="stylesheet" media="all">
   

    <link href="{% static 'css/main.css' %}" rel="stylesheet" media="all">
    <style>
      .translatebtn{
            width: 75px;
			height: 50px;
			border-radius: 5px;
            background-color: rgb(145 31 127);
            box-shadow: 3px 3px rgb(75 21 78);
			color: rgb(246, 235, 235);
			outline: none;
			border: none;
            margin-left: 10px;
      }
      .categaddbtn{
        width: 53px;
    /* margin: 0rem 2rem; */
    height: 49px;
    border-radius: 5px !important;
    background-color: rgb(50, 137, 50);
    color: rgb(246, 235, 235);
    outline: none;
    border-radius: 10rem;
    margin-left: 10px !important;
    font-size: 24px;
      }
        .comboclass{
            height: 50px;
    width: 25rem;
    border-radius: 13px;
    background-color: #eee;
    justify-content: center;
    text-align: center;
    font-size: 16px;


  }
  .select option{
    height: 50px;
    width:100%;
    


  }
  .btnclass{
    display: flex;
    margin-left: 0px;
    margin-top: 40px;
    padding: 20px;
    justify-content: center;
    gap: 20px;
  }
  .btnregister, .btnclose, .btnclear{
    width:170px;
    height: 50px;
    border-radius: 10px;
    color: white;
    font-weight: bold;
  }
  .btnclear{
    background-color: rgb(57, 180, 214);
    
  }
  .btnregister{
    background-color: rgb(57, 214, 122);
  }
  .btnclose{
    background-color: red;
  }
  #ilang{
    width: 89%;
    margin-right: .5rem;
  }

.fa-refresh{
    margin-top: 3px;
    font-size: 2.2rem;
    color: #193f4fb0;
    padding-left: 9px;
}
.label--desc {
  
    color: #2f2f2f;
}
 /* For Mobile  */
  @media (max-width:600px){
    .btnregister, .btnclose, .btnclear{
    width:80px;
    height: 35px;
    border-radius: 5px;
    color: white;
    font-weight: bold;
  }
  .btnclass{
    display: flex;
    margin-left: 0px;
    margin-top: 40px;
    padding: 20px;
    justify-content: center;
    gap: 20px;
  }

  .card {
    width: 100%;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background: #fff;
}

.card-5 {
  background: #fff;
  -webkit-border-radius: 10px;
  -moz-border-radius: 10px;
  border-radius: 10px;
  -webkit-box-shadow: 0px 8px 20px 0px rgba(0, 0, 0, 0.15);
  -moz-box-shadow: 0px 8px 20px 0px rgba(0, 0, 0, 0.15);
  box-shadow: 0px 8px 20px 0px rgba(0, 0, 0, 0.15);
}

.card-5 .card-heading {
  padding: 10px;
  background: #1a1a1a;
  -webkit-border-top-left-radius: 10px;
  -moz-border-radius-topleft: 10px;
  border-top-left-radius: 10px;
  -webkit-border-top-right-radius: 10px;
  -moz-border-radius-topright: 10px;
  border-top-right-radius: 10px;
}

.card-5 .card-body {
  padding: 30px 30px;
  padding-bottom: 73px;
}
.page-wrapper{
    padding-top: 0px;
    padding: 0px;
}
.title {
  font-size: 17px;
  text-transform: uppercase;
  font-weight: bold;
  text-align: center;
  color: #fff;
}
.comboclass{
  height: 40px;
  width:140px;
  border-radius: 5px;
  background-color: #eee;
  text-align: center;
}
.taxdiv{
    margin-left: 0px;
}
.translatebtn {
    font-size: 12px;
    padding: 5px;
    border-radius: 13px;
    box-shadow: none;
}
#ilang {
    width: 75%;
}
  }


  /* /for tablet */
  @media(max-width: 1024px) and (min-width: 600px){
    .btnregister, .btnclose, .btnclear{
    width:80px;
    height: 35px;
    border-radius: 5px;
    color: white;
    font-weight: bold;
  }
  .btnclass{
    margin-left: 0px;
    display: flex;
    
    margin-top: 40px;
    padding: 20px;
    justify-content: center;
    gap: 20px;
  }

  .card {
    width: 100%;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background: #fff;
}

.card-5 {
  background: #fff;
  -webkit-border-radius: 10px;
  -moz-border-radius: 10px;
  border-radius: 10px;
  -webkit-box-shadow: 0px 8px 20px 0px rgba(0, 0, 0, 0.15);
  -moz-box-shadow: 0px 8px 20px 0px rgba(0, 0, 0, 0.15);
  box-shadow: 0px 8px 20px 0px rgba(0, 0, 0, 0.15);
}

.card-5 .card-heading {
  padding: 10px;
  background: #1a1a1a;
  -webkit-border-top-left-radius: 10px;
  -moz-border-radius-topleft: 10px;
  border-top-left-radius: 10px;
  -webkit-border-top-right-radius: 10px;
  -moz-border-radius-topright: 10px;
  border-top-right-radius: 10px;
}

.card-5 .card-body {
  padding: 30px 30px;
  padding-bottom: 73px;
}
.page-wrapper{
    padding-top: 0px;
    padding: 0px;
}
.title {
  font-size: 17px;
  text-transform: uppercase;
  font-weight: bold;
  text-align: center;
  color: #fff;
}
.comboclass{
  height: 40px;
  width:140px;
  border-radius: 5px;
  background-color: #eee;
  text-align: center;
}
.taxdiv{
    margin-left: 0px;
}

.name{
    width: 10%;
}


  }




    </style>
</head>

<body onload="onloaditems()">

    <div class="page-wrapper bg-gra-03 p-t-45 p-b-50">
        <div class="wrapper ">
            <div class="card card-5">
                <div class="card-heading">
                    <h2 class="title">Add Item</h2>
                </div>
                <div class="card-body">
                    <form method="POST" id="itemform" onkeydown="keyDownTextField(event)">
                        {% csrf_token %}
<div class="itemid-row">
                           
                            <div class="value">
                                <div class="col-sm-3 col-md-12 col-lg-3">

                                    <input class="input--style-5"  id="itemid" name="itemid" style="border: 0px;background-color: white;font-weight: bold;" value="{{itemidd}}" readonly>
                                </div>
                            </div>
    </div>
                        <div class="form-row">
                            <div class="name">Barcode</div>
                            <div class="value">
                                <div class="input-group">
                                    <input class="input--style-5" id="bcode" onkeydown='handleEnter(event)' value="{{itemiddbcode}}" id="barcode" type="text" name="barcode" required/>
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="name">Itemname</div>
                            <div class="value">
                                <div class="input-group">
                                    <input class="input--style-5" type="text" onkeydown='handleEnter(event)'  id="itemname" onblur="printvalue()" name="itemname">
                                </div>
                            </div>
                        </div>
                          <div class="form-row">
                            <div class="name">Itemcode</div>
                            <div class="value">
                                <div class="input-group">
                                    <input class="input--style-5" type="text" onkeydown="handleEnter(event)"  id="itemcode"  name="itemcode">
                                </div>
                            </div>
                        </div>
                       
                        <div class="form-row">
                            <div class="name">Second Language</div>
                            <div class="value">
                                <div class="input-group " style="flex-wrap: none">
                                    <input class="input--style-5" width="70%" type="text" id="ilang" onkeydown="handleEnter(event)" name="secodlanguage">
                                    <button class="translatebtn" type="button" onclick="translatearabic()">Translate</button>
                                </div>
                               
                            </div>
                        </div>
                    
                        <div class="form-row">
                            <div class="name">Item manufacturer</div>
                            <div class="value">
                                <div class="input-group">
                                    <input class="input--style-5" onkeydown='handleEnter(event)' type="text" name="manufacturer">
                                </div>
                            </div>
                        </div>
                        
                        
                        <div class="form-row m-b-55">
                            <div class="name">Rate</div>
                            <div class="value">
                                <div class="row row-refine">
                                    <div class="col-9">
                                        <div class="input-group-desc">
                                            <input class="input--style-5" onkeydown='handleEnter(event)'  step="0.01" id="prate" placeholder="0.0" type="number" name="prate">
                                            <label class="label--desc">Purchase Rate</label>
                                        </div>
                                    </div>
                                    <div class="col-3">
                                        <div class="input-group-desc">
                                            <input class="input--style-5" onkeydown='handleEnter(event)' id="srate"   step="0.01" placeholder="0.0" type="number" name="srate">
                                            <label class="label--desc">Sale Rate</label>
                                        </div>
                                    </div>
                                  
                                </div>
                            </div>
                        </div>


                    



                          

 <div class="form-row">
                            <div class="name">Op.Qty</div>
                            <div class="value">
                                <div class="input-group">
                                    <input class="input--style-5" onkeydown='handleEnter(event)' id="op" type="number"  name="opqty">
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="name">Vat</div>
                            <div class="value">
                                <div class="input-group">
                                    <input class="input--style-5" onkeydown='handleEnter(event)' type="number" value="15.0" id="vat" name="vat">
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="name">Using Mechine</div>
                            <div class="value">
                                <div class="input-group">
                                    <div class="comboclass">

                                        <select name="usingmechine"  class="comboclass" id="usingmechine">


                                            <option value="-1">No</option>
                                            <option value="1">Yes</option>
                                        </select>

                                        <div class="select-dropdown"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="name">Item Category</div>
                            <div class="value">
                                <div class="input-group">
                                    <div class="comboclass">

                                        <select name="itemcategory" id="categ"  class="comboclass">
                                            {% if categ != 'None' %}
{% for i in categ %}
                                            <option value="{{i.categoryid}}" >{{i.categoryname}}</option>
{% endfor %}
                                            {% else %}
                                            <option value >None</option>
                                            {% endif %}
                                        </select>

                                        <div class="select-dropdown"></div>
                                    </div>
                                    <button type="button" onclick="addcateg()" class="categaddbtn">+</button>
                                    <i class="fa fa-refresh"  onclick="refreshcateg()"></i>
                                </div>
                               
                            </div>
                      
                        </div>

                        <div class="form-row">
                            <div class="name">Itemclass</div>
                            <div class="value">
                                <div class="input-group">
                                    <div class="rs-select2  " >
                                        <select name="itemclass" class="comboclass" id="iclass" >

                                            <option value="0">Stock Item</option>
                                            <option value="1">Services</option>
                                            <option value="2">Finished product</option>
                                            <option value="3">Finished product2</option>

                                        </select>
                                      
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-row m-b-55">
                            <div class="name">Tax Inclusive</div>
                            <div class="value">
                                <div class="row row-refine">

                                    <div class="col-3">
                                        <div class="input-group-desc">
                                            <select onkeydown='handleEnter(event)'  name="saletax" id="stax"  class="comboclass">

                                                <option value="1">Yes</option>
                                                <option value="-1">No</option>
    
                                            </select>
                                            <div class="select-dropdown"></div>  
                                         <label class="label--desc">Sale tax</label>
                                        </div>
                                    </div>
                                    <div class="col-9">
                                        <div class="taxdiv">
                                        <div class="input-group-desc">
                                            <select onkeydown='handleEnter(event)'  name="ptax" id="ptax"  class="comboclass">

                                                <option value="-1">No</option>
                                                <option value="1">Yes</option>
    
                                            </select>
                                            <div class="select-dropdown"></div>
                                            <label class="label--desc">purchase Tax</label>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                            </div>
                        </div>


<input name="edittype" id="edit" value="{{type}}" hidden="hidden"/>
<input name="cmp" id="cmp" value="{{user}}" hidden="hidden"/>
<input name="cmp" id="area" value="{{area}}" hidden="hidden"/>
<input name="cmp" id="user" value="{{cuser}}" hidden="hidden"/>

                        <div class="btnclass">
                            {% if type != 'edit' %}
                            <button class="btnclear" onclick="clearfn()" type="button" >Clear</button>
                            {% endif %}
                            <button class="btnregister" type="button" onclick="savefn()" >Save</button>
                            <button class="btnclose" onclick="closefn()" type="button" >Close</button>
                        </div>
                        {% for i in messages %}
      <a>{{i}}</a>
<!--                        <div>-->
<!--                            <button class="btn btn&#45;&#45;radius-2 btn&#45;&#45;red" type="submit"><a href="/home">sgggggggggg</a></button>-->
<!--                        </div>-->

                    </form>
                </div>
            </div>
        </div>
    </div>
 {% endfor %}
    
   
<script>
function addcateg(){
window.open('/itemcateg')
}

async function translatearabic(){
    
  const name = document.getElementById(`itemname`).value;

  try {
                const response = await fetch(`/translate/?arabic=${name}`);
                const data = await response.json();

                if (data.engtext) {
                    document.getElementById('ilang').value = data.engtext
                }
            } catch (error) {
                console.error('Error:', error);
                
            }

}
function arabictext(data){
  document.getElementById(`ilang`).value=data.engtext;
}
// Example usage


function savefn(){
    if( document.getElementById("bcode").value==''){
        alert("Please enter barcode")
    }
    else if( document.getElementById("itemname").value==''){
        alert("Please enter itemname")
    }
    else{
        const etype= document.getElementById("edit").value;
        if(etype!='edit'){
    const query= document.getElementById("bcode").value;
        
        fetch(`/validate/?query=${query}&type=${'item'}`)
            .then(response => response.json())
            .then(data => saveform(data.data,query)
            );
function saveform(barcodelen,bcode){
    if(barcodelen==0){
        if(bcode==''){
            alert("Please enter barcode")
        }
        else{
            document.getElementById("itemform").submit();
        }
                
            }
      else{
       
        alert("Barcode already exist")
      }
}
        }
        else{
            
getmaxid();
            document.getElementById("itemform").submit();  
        }
    }
}
function getmaxid(){
    const typeed = document.getElementById("edit").value;
            
            if (typeed!="edit"){
            const vno = document.getElementById(`itemid`);

  
    fetch(`/getvno/?type=${"item"}`)
    .then(response => response.json())
    .then(data => vno.value=data.vno
    
    
    );
}
}
     
     function onloaditems(){
      
        const typeedit = document.getElementById("edit").value;


if(typeedit=='edit'){
                const bcode= document.getElementById('bcode')
    bcode.focus();
    document.getElementById('vat').value=15+'.0';

    const previd={{ preid|safe }};
    
    if(previd!='empt'){
        
        fetch(`/getitem/?query=${previd}&type=${'item'}`)
        .then(response => response.json())
        .then(data =>  setitem(data.customers)  
      );
            
    }
}

    
     }

    
//to save 





function setitem(itemdata){

        itemdata.forEach((item,index) => {
           
      
        document.getElementById(`itemid`).value=item.id;
        document.getElementById(`bcode`).value=item.bcode;
        document.getElementById(`itemname`).value=item.name;
        document.getElementById(`itemcode`).value=item.itemcode;
        document.getElementById(`ilang`).value=item.ilang;
        document.getElementById(`srate`).value=item.srate;
        document.getElementById(`prate`).value=item.prate;
        document.getElementById(`vat`).value=item.vat;
        document.getElementById(`op`).value=item.os;



        var iclasscombo = document.getElementById("iclass");
        var incscombo = document.getElementById("stax");
        var incpcombo = document.getElementById("ptax");
        var categcombo = document.getElementById("categ");
        var umechinecombo = document.getElementById("usingmechine");

  // Set the selected value
 
  incscombo.value = item.incs;
  incpcombo.value=item.incp;
  if(item.itemclass=='Stock Item'){
    iclasscombo.value="0"
  }
  else if(item.itemclass=='Services'){
    iclasscombo.value="1"
  }
  else if(item.itemclass=='Finished product'){
    iclasscombo.value="2"
  }
  else if(item.itemclass=='Finished product2'){
    iclasscombo.value="3"
  }

  categcombo.value=item.categoryid;
  umechinecombo.value=item.usingmechine;
        
        });
    }
 

document.addEventListener("keydown", keyDownTextField, false);
function keyDownTextField(e) {
   
    if(event.key == 'F12') {
  
  event.preventDefault();
 document.getElementById("bcode").focus()
 
}
  else if(event.key === 'F5') {
    event.preventDefault()
    if( document.getElementById("bcode").value==''){
        alert("Please enter barcode")
    }
    else if( document.getElementById("itemname").value==''){
        alert("Please enter itemname")
    }
    else{
        const etype= document.getElementById("edit").value;
        if(etype!='edit'){
getmaxid();
       const query= document.getElementById("bcode").value;
        
        fetch(`/validate/?query=${query}&type=${'item'}`)
            .then(response => response.json())
            .then(data => saveform(data.data,query)
            );
function saveform(barcodelen,bcode){
    if(barcodelen==0){
        if(bcode==''){
            alert("Please enter barcode")
        }
        else{
                document.getElementById("itemform").submit();
        }
            }
      else{
       
        alert("Barcode already exist")
      }
}
    }
    else{
        document.getElementById("itemform").submit(); 
    }
            
    }

  }
  if(event.key === 'Tab') {
    // alert(document.activeElement.value)
  }



}
function printvalue(){
iname=document.getElementById('itemname').value;
document.getElementById('itemcode').value=iname;
}
    function handleEnter(event) {
        
   if (event.key==="Enter") {
  
    event.preventDefault()
      const form = document.getElementById('itemform')
      const index = [...form].indexOf(event.target);
      if(event.target.id=='ilang'){
        form.elements[index + 2].focus();
      }
      else{

      
      form.elements[index + 1].focus();
      }
      //event.preventDefault();
    }
}
  
function clearfn(){

location.reload();
} 
function closefn(){
    const typed=document.getElementById('edit').value

if(typed=='edit'){
    
    window.close();
}
else{

    window.location.href ='/home';
}
}



function refreshcateg(){
    fetch(`/getallitemcateg/`)
      .then(response => response.json())
      .then(data => setitemcateg(data)    );
        
}

//to save 





function setitemcateg(itemdata){
    console.log(itemdata)
    var categcombo = document.getElementById("categ");
    categcombo.innerHTML='';
        itemdata.forEach((item,index) => {
           
var optioncat = document.createElement('option');
optioncat.value = item.categid;
optioncat.innerHTML = item.name;

// Append the option to the select dropdown
categcombo.appendChild(optioncat);
        })
}
</script>


</body><!-- This templates was made by Colorlib (https://colorlib.com) -->

</html>
<!-- end document-->
{% endblock%}