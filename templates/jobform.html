
{% extends 'navbar.html' %}
{% load static %}
{% block content %}
<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Colorlib Templates">
    <meta name="author" content="Colorlib">
    <meta name="keywords" content="Colorlib Templates">

    <!-- Title Page-->


    <!-- Icons font CSS-->
<!--    <link href="{% static 'mdi-font/css/material-design-iconic-font.min.css' %}" rel="stylesheet" media="all">-->
<link href="{% static 'css/material-design-iconic-font.min.css' %}" rel="stylesheet" media="all">

    <!-- <link href="{% static 'font-awesome-4.7/css/font-awesome.min.css' %}" rel="stylesheet" media="all"> -->
    <!-- Font special for pages-->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">

    <!-- Vendor CSS-->
    <link href="{% static 'css/select2.min.css' %}" rel="stylesheet" media="all">
  

    <link href="{% static 'css/main.css' %}" rel="stylesheet" media="all">
    <style>
        .comboclass{
    height: 50px;
    width:230px;
    border-radius: 5px;
    background-color: #eee;
    justify-content: center;
    text-align: center;
    font-size: 16px;


  }
  .select option{
    height: 50px;
    width:100%;
    


  }
  .btnclass{
    margin-left: 250px;
    padding-left: 10px;
    justify-content: center;
  }
  .addbtn{
    margin-left: 20px;
    height: 30px;
    border: 5px;
    border-radius: 10px solid;
    color: #eee;
    width: 30px;
    background-color: green;
    text-align: center;
  }
  .btnregister, .btnclose, .btnclear{
    width:170px;
    height: 50px;
    border-radius: 10px;
    color: white;
    font-weight: bold;
  }
  .btnclear{
    background-color: rgb(57, 180, 214);
    
  }
  .btnregister{
    background-color: rgb(57, 214, 122);
  }
  .btnclose{
    background-color: red;
  }
  @media (max-width:500px){
    .btnregister, .btnclose, .btnclear{
    width:80px;
    height: 35px;
    border-radius: 5px;
    color: white;
    font-weight: bold;
  }
  .btnclass{
    display: flex;
    margin-left: 0px;
    margin-top: 40px;
    padding: 20px;
    justify-content: center;
    gap: 20px;
  }

  .card {
    width: 100%;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background: #fff;
}

.card-5 {
  background: #fff;
  -webkit-border-radius: 10px;
  -moz-border-radius: 10px;
  border-radius: 10px;
  -webkit-box-shadow: 0px 8px 20px 0px rgba(0, 0, 0, 0.15);
  -moz-box-shadow: 0px 8px 20px 0px rgba(0, 0, 0, 0.15);
  box-shadow: 0px 8px 20px 0px rgba(0, 0, 0, 0.15);
}

.card-5 .card-heading {
  padding: 10px;
  background: #1a1a1a;
  -webkit-border-top-left-radius: 10px;
  -moz-border-radius-topleft: 10px;
  border-top-left-radius: 10px;
  -webkit-border-top-right-radius: 10px;
  -moz-border-radius-topright: 10px;
  border-top-right-radius: 10px;
}

.card-5 .card-body {
  padding: 30px 30px;
  padding-bottom: 73px;
}
.page-wrapper{
    padding-top: 0px;
    padding: 0px;
}
.title {
  font-size: 17px;
  text-transform: uppercase;
  font-weight: bold;
  text-align: center;
  color: #fff;
}
.comboclass{
  height: 40px;
  width:140px;
  border-radius: 5px;
  background-color: #eee;
  text-align: center;
  margin-right: 10px;
}
.taxdiv{
    margin-left: 0px;
}
  }
    </style>
</head>

<body>

    <div class="page-wrapper bg-gra-03 p-t-45 p-b-50">
        <div class="wrapper ">
            <div class="card card-5">
                <div class="card-heading">
                    <h2 class="title">Jobcard</h2>
                </div>
                <div class="card-body">
                    <form method="POST" id="itemform" onkeydown="keyDownTextField(event)">
                        {% csrf_token %}
<div class="form-row">
                            <div class="name">Job Id</div>
                            <div class="value">
                                <div class="col-sm-3 col-md-12 col-lg-3">

                                    <input class="input--style-5"  id="itemid" name="itemid" style="border: 0px;background-color: white;font-weight: bold;" value="{{itemidd}}" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="name">Name</div>
                            <div class="value">
                                <div class="input-group">
                                    <input class="input--style-5" id="name" onkeydown='handleEnter(event)'  type="text" name="name" required/>
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="name">Iqama No.</div>
                            <div class="value">
                                <div class="input-group">
                                    <input class="input--style-5" type="text" onkeydown='handleEnter(event)'  id="iqama"  name="iqama">
                                </div>
                            </div>
                        </div>
                          <div class="form-row">
                            <div class="name">Note</div>
                            <div class="value">
                                <div class="input-group">
                                    <input class="input--style-5" type="text"   id="note"  name="note">
                                </div>
                            </div>
                        </div>
                        
                       
                           <div class="form-row">
                            <div class="name">Item Category</div>
                            <div class="value">
                                <div class="input-group">
                                    <div class="comboclass">

                                        <select name="wcategory" id="categ"  class="comboclass">
                                            {% if categ != 'None' %}
{% for i in categ %}
                                            <option value="{{i.wid}}" >{{i.wcategory}}</option>
{% endfor %}
                                            {% else %}
                                            <option value="0" >None</option>
                                            {% endif %}
                                        </select>

                                        <div class="select-dropdown"></div>
                                    </div>
                                    <a class="addbtn" href="/workcateg/?comp={{user}}&user={{cuser}}&area={{area}}">+</a>
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="name">Email</div>
                            <div class="value">
                                <div class="input-group">
                                    <input class="input--style-5  " id="mail" type="text" name="mail">
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="name">Country</div>
                            <div class="value">
                                <div class="input-group">
                                    <div class="rs-select2  " >
                                        <select name="country" class="comboclass" id="country" >

                                            {% for i in country %}
                                            <option value="{{i.name}}" >{{i.name}}</option>
{% endfor %}

                                        </select>
                                      
                                    </div>
                                </div>
                            </div>
                        </div>
                          <div class="form-row">
                            <div class="name">Mobile</div>
                            <div class="value">
                                <div class="input-group">
                                    <input class="input--style-5"  type="number"  id="mobile" name="mobile">
                                </div>
                            </div>
                        </div>
                      




                          

 <div class="form-row">
                            <div class="name">Whatsapp No.</div>
                            <div class="value">
                                <div class="input-group">
                                    <input class="input--style-5"   type="number" id="whatsapp" name="whatsapp">
                                </div>
                            </div>
                        </div>


<input name="edittype" id="edit" value="{{type}}" hidden="hidden"/>
<input name="cmp" id="cmp" value="{{user}}" hidden="hidden"/>
<input name="cmp" id="area" value="{{area}}" hidden="hidden"/>
<input name="cmp" id="user" value="{{cuser}}" hidden="hidden"/>
<input name="preid" id="preid" value="{{preid}}" hidden="hidden"/>

                        <div class="btnclass">
                            {% if type != 'edit' %}
                            <button class="btnclear" onclick="clearfn()" type="button" >Clear</button>
                            {% endif %}
                            <button class="btnregister" type="button" onclick="savefn()" >Save</button>
                            <button class="btnclose" onclick="closefn()" type="button" >Close</button>
                        </div>
                        {% for i in messages %}
      <a>{{i}}</a>
<!--                        <div>-->
<!--                            <button class="btn btn&#45;&#45;radius-2 btn&#45;&#45;red" type="submit"><a href="/home">sgggggggggg</a></button>-->
<!--                        </div>-->

                    </form>
                </div>
            </div>
        </div>
    </div>
 {% endfor %}
    <!-- Jquery JS-->
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <!-- Vendor JS-->
    <script src="{% static 'js/select2.min.js' %}"></script>
    <!-- <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script> -->
<!--    <script src="{% static 'vendor/datepicker/moment.min.js' %}"></script>-->
<!--    <script src="{% static 'vendor/datepicker/daterangepicker.js' %}"></script>-->

    <!-- Main JS-->
    <script src="{% static 'js/global.js' %}"></script>
<script>

function savefn(){
    
    if( document.getElementById("name").value==''){
        alert("Please enter name")
    }
    else{
        const etype= document.getElementById("edit").value;
        if(etype!='edit'){
    const query= document.getElementById("name").value;
        
        fetch(`/validate/?query=${query}&type=${'job'}&company=${company}`)
            .then(response => response.json())
            .then(data => saveform(data.data,query)
            );
function saveform(barcodelen,name){
    if(barcodelen==0){
        if(name==''){
            alert("Please enter name")
        }
        else{
            document.getElementById("itemform").submit();
        }
                
            }
      else{
       
        alert("name already exist")
      }
}
        }
        else{
            
// getmaxid();
            document.getElementById("itemform").submit();  
        }
    }
}
function getmaxid(){
    const typeed = document.getElementById("edit").value;
            
            if (typeed!="edit"){
            const vno = document.getElementById(`itemid`);

  const company = document.getElementById(`cmp`).value;
    fetch(`/getvno/?type=${"item"}&company=${company}`)
    .then(response => response.json())
    .then(data => vno.value=data.vno
    
    
    );
}
}
     const company= document.getElementById('cmp').value;
     
  const nm= document.getElementById('name')
nm.focus();


const previd=document.getElementById('preid').value;
if(previd!='empt'){
   
    fetch(`/getjob/?query=${previd}&type=${'item'}&comp=${company}`)
      .then(response => response.json())
      .then(data => setitem(data.customers)    );
        
}


//to save 





function setitem(itemdata){
        itemdata.forEach((item,index) => {
           
       
        document.getElementById(`itemid`).value=item.id;
        document.getElementById(`name`).value=item.name;
        document.getElementById(`iqama`).value=item.iqama;
        document.getElementById(`note`).value=item.note;
        document.getElementById(`mobile`).value=item.mobile;
        document.getElementById(`whatsapp`).value=item.whatsapp;
        document.getElementById(`mail`).value=item.email;
        



        var iclasscombo = document.getElementById("country");
        // var incscombo = document.getElementById("stax");
        // var incpcombo = document.getElementById("ptax");
         var categcombo = document.getElementById("categ");
        // var umechinecombo = document.getElementById("usingmechine");

  // Set the selected value
 
   iclasscombo.value = item.country;
//   incpcombo.value=item.incp;
//   if(item.itemclass=='Stock Item'){
//     iclasscombo.value="0"
//   }
//   else if(item.itemclass=='Services'){
//     iclasscombo.value="1"
//   }
//   else if(item.itemclass=='Finished product'){
//     iclasscombo.value="2"
//   }
//   else if(item.itemclass=='Finished product2'){
//     iclasscombo.value="3"
//   }

   categcombo.value=item.cid;
//   umechinecombo.value=item.usingmechine;
        
        });
    }
 

document.addEventListener("keydown", keyDownTextField, false);
function keyDownTextField(e) {
   
    if(event.key == 'F12') {
  
  event.preventDefault();
 document.getElementById("bcode").focus()
 
}
  else if(event.key === 'F5') {
    event.preventDefault()
     if( document.getElementById("name").value==''){
        alert("Please enter name")
    }
    else{
        const etype= document.getElementById("edit").value;
        if(etype!='edit'){
// getmaxid();
       const query= document.getElementById("name").value;
        
        fetch(`/validate/?query=${query}&type=${'job'}&company=${company}`)
            .then(response => response.json())
            .then(data => saveform(data.data,query)
            );
function saveform(barcodelen,name){
    if(barcodelen==0){
        if(name==''){
            alert("Please enter name")
        }
        else{
                document.getElementById("itemform").submit();
        }
            }
      else{
       
        alert("Name already exist")
      }
}
    }
    else{
        document.getElementById("itemform").submit(); 
    }
            
    }

  }
  if(event.key === 'Tab') {
    // alert(document.activeElement.value)
  }



}
function printvalue(){
iname=document.getElementById('itemname').value;
document.getElementById('itemcode').value=iname;
}
    function handleEnter(event) {
   if (event.key==="Enter") {
    event.preventDefault()
      const form = document.getElementById('itemform')
      const index = [...form].indexOf(event.target);
      form.elements[index + 1].focus();
      //event.preventDefault();
    }
}
  
function clearfn(){

location.reload();
} 
function closefn(){
    const typed=document.getElementById('edit').value
    const area=document.getElementById('area').value
    const user=document.getElementById('user').value
if(typed=='edit'){
    
    window.close();
}
else{

    window.location.href ='/home/?comp='+company+'&area='+area+'&user='+user+'';
}
}
</script>


</body><!-- This templates was made by Colorlib (https://colorlib.com) -->

</html>
<!-- end document-->
{% endblock%}